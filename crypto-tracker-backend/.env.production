# ===============================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# ===============================================
# This file contains settings for production environment.
# Maximum security, performance, and reliability settings.

# ENVIRONMENT IDENTIFICATION
NODE_ENV=production
FLASK_ENV=production
FLASK_DEBUG=false  # NEVER enable debug in production
ENV_NAME=production

# DATABASE CONFIGURATION
# PostgreSQL managed database with connection pooling
DATABASE_URL=${DATABASE_URL}
DATABASE_ECHO=false  # Never log SQL in production
DATABASE_POOL_SIZE=20  # Higher connection pool
DATABASE_MAX_OVERFLOW=30
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600  # Recycle connections hourly

# REDIS CONFIGURATION
# Production Redis with persistence
REDIS_URL=${REDIS_URL}
REDIS_MAX_CONNECTIONS=100
CACHE_TIMEOUT=1800  # 30 minutes cache
CACHE_DEFAULT_TIMEOUT=3600  # 1 hour default

# AUTHENTICATION & SECURITY
# Strong, unique secrets (managed by secrets management)
JWT_SECRET_KEY=${JWT_SECRET_KEY}
JWT_ACCESS_TOKEN_EXPIRES=3600  # 1 hour for security
JWT_REFRESH_TOKEN_EXPIRES=604800  # 7 days
SECRET_KEY=${SECRET_KEY}

# PASSWORD SECURITY
PASSWORD_MIN_LENGTH=12
REQUIRE_PASSWORD_COMPLEXITY=true
PASSWORD_HISTORY_COUNT=5  # Prevent reusing last 5 passwords

# API CONFIGURATION
# Production rate limiting
RATE_LIMIT_PER_MINUTE=60  # Conservative for production
RATE_LIMIT_PER_HOUR=1000
RATE_LIMIT_PER_DAY=10000
API_VERSION=v1

# CORS CONFIGURATION
# Strict CORS for production
FRONTEND_URL=${FRONTEND_URL}
CORS_ORIGINS=${FRONTEND_URL}
CORS_ALLOW_CREDENTIALS=true
CORS_MAX_AGE=86400  # 24 hours

# EXTERNAL APIS
COINGECKO_API_URL=https://api.coingecko.com/api/v3
COINGECKO_API_KEY=${COINGECKO_API_KEY}
COINGECKO_RATE_LIMIT=50  # API calls per minute

# LOGGING CONFIGURATION
LOG_LEVEL=WARNING  # Only log warnings and errors
LOG_TO_FILE=true
LOG_FILE_PATH=/var/log/crypto_tracker/app.log
LOG_MAX_SIZE=100MB
LOG_BACKUP_COUNT=5
LOG_FORMAT=json  # Structured logging for production

# SECURITY HEADERS
SECURITY_HEADERS=true
CONTENT_SECURITY_POLICY=true
X_FRAME_OPTIONS=DENY
X_CONTENT_TYPE_OPTIONS=nosniff
REFERRER_POLICY=strict-origin-when-cross-origin

# PRODUCTION FEATURES
# Disable all debug/development features
ENABLE_DEBUG_ENDPOINTS=false
ENABLE_MOCK_DATA=false
SKIP_EMAIL_VERIFICATION=false

# MONITORING & PERFORMANCE
# Full monitoring suite enabled
ENABLE_METRICS=true
ENABLE_TRACING=true
ENABLE_PROFILING=false  # Too expensive for production
METRICS_PORT=9090

# APPLICATION PERFORMANCE MONITORING
SENTRY_DSN=${SENTRY_DSN}
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1  # Sample 10% of transactions

# BACKUP CONFIGURATION
# Comprehensive backup strategy
ENABLE_AUTOMATED_BACKUPS=true
BACKUP_FREQUENCY=hourly
BACKUP_RETENTION_DAYS=30
BACKUP_ENCRYPTION=true
BACKUP_COMPRESSION=true
BACKUP_VERIFICATION=true

# NOTIFICATION SETTINGS
# Full notification system enabled
ENABLE_PRICE_ALERTS=true
ENABLE_EMAIL_NOTIFICATIONS=true
EMAIL_BACKEND=smtp
SMTP_HOST=${SMTP_HOST}
SMTP_PORT=${SMTP_PORT}
SMTP_USE_TLS=true
SMTP_USERNAME=${SMTP_USERNAME}
SMTP_PASSWORD=${SMTP_PASSWORD}

# DATABASE MANAGEMENT
SEED_TEST_DATA=false  # NEVER seed test data in production
AUTO_MIGRATE_DB=false  # Manual migration approval required
REQUIRE_MIGRATION_CONFIRMATION=true

# PORT CONFIGURATION
PORT=${PORT:-5001}
HOST=0.0.0.0

# SSL/TLS CONFIGURATION
USE_HTTPS=true
SSL_REDIRECT=true
HSTS_MAX_AGE=31536000  # 1 year
HSTS_INCLUDE_SUBDOMAINS=true

# SECURITY SETTINGS
# Maximum security for production
BYPASS_RATE_LIMITS=false
ALLOW_WEAK_PASSWORDS=false
DISABLE_CSRF=false
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=Strict

# PERFORMANCE SETTINGS
# Optimized for production load
WORKER_PROCESSES=${WEB_CONCURRENCY:-4}
WORKER_TIMEOUT=30  # Shorter timeout for better UX
WORKER_MAX_REQUESTS=1000
WORKER_MAX_REQUESTS_JITTER=100
KEEP_ALIVE=5

# CACHING STRATEGY
# Aggressive caching for performance
ENABLE_RESPONSE_CACHING=true
CACHE_CONTROL_MAX_AGE=300  # 5 minutes
ENABLE_ETAG=true
ENABLE_COMPRESSION=true

# RESOURCE LIMITS
# Production resource limits
MAX_REQUEST_SIZE=10MB
MAX_PORTFOLIO_SIZE=10000
MAX_TRANSACTIONS_PER_USER=100000
MAX_PRICE_ALERTS=100
MAX_CONCURRENT_USERS=1000

# FEATURE FLAGS
# Production feature toggles
ENABLE_ADVANCED_ANALYTICS=true
ENABLE_PORTFOLIO_SHARING=true
ENABLE_EXPORT_FEATURES=true
ENABLE_API_VERSIONING=true

# HEALTH CHECKS
# Comprehensive health monitoring
HEALTH_CHECK_INTERVAL=30  # seconds
HEALTH_CHECK_TIMEOUT=5
ENABLE_READINESS_PROBE=true
ENABLE_LIVENESS_PROBE=true

# DISASTER RECOVERY
# Production disaster recovery settings
ENABLE_CIRCUIT_BREAKER=true
CIRCUIT_BREAKER_FAILURE_THRESHOLD=10
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60
ENABLE_GRACEFUL_SHUTDOWN=true
SHUTDOWN_TIMEOUT=30

# COMPLIANCE & AUDITING
# Regulatory compliance features
ENABLE_AUDIT_LOGGING=true
AUDIT_LOG_RETENTION_DAYS=2555  # 7 years
ENABLE_DATA_ENCRYPTION=true
ENABLE_PII_ANONYMIZATION=true

# MAINTENANCE WINDOWS
# Scheduled maintenance configuration
MAINTENANCE_WINDOW_START=02:00  # 2 AM UTC
MAINTENANCE_WINDOW_DURATION=60  # 1 hour
ENABLE_MAINTENANCE_MODE=false

# GEOGRAPHIC SETTINGS
TIMEZONE=UTC
DEFAULT_CURRENCY=USD
SUPPORTED_CURRENCIES=USD,EUR,GBP,JPY

# PRODUCTION OPTIMIZATIONS
# Performance optimizations
ENABLE_CONNECTION_POOLING=true
ENABLE_QUERY_OPTIMIZATION=true
ENABLE_INDEX_OPTIMIZATION=true
ENABLE_LAZY_LOADING=true